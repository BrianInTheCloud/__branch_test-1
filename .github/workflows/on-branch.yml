on:
  create # does not support filtering by type (branch), must do later

jobs:
  create-branch:
    if: github.ref_type == 'branch' # create can be branches or tags; we want only branches
    runs-on: ubuntu-latest

    steps:

    # - name: Check out everything from main
    #   uses: actions/checkout@v4
    #   with:
    #     fetch-depth: 0
    #     path: source

    - name: Create New Repo for Branch
      run: |
        gh repo create __branch_${{ github.ref_name }} --public
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Copy Site Into New Repo
      if: false
      run: |
        git config user.username ${{ github.repository_owner }}
        git clone --bare https://github.com/${{ github.repository_owner }}/${{ github.event.repository.name }}
        cd ${{ github.event.repository.name }}.git
        gh repo create __branch_${{ github.ref_name }} --public
        git push --mirror https://github.com/${{ github.repository_owner }}/__branch_${{ github.ref_name }}
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
